services:
  aspire.dashboard:
    environment:
      - ASPIRE_DASHBOARD_UNSECURED_ALLOW_ANONYMOUS=true
    ports:
      - 18888:18888

  template.api:
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_HTTP_PORTS=80
      - OpenTelemetry__WithMetrics__Exporters__Otlp__Endpoint=http://aspire.dashboard:18889
      - OpenTelemetry__WithTracing__Exporters__Otlp__Endpoint=http://aspire.dashboard:18889
      - OpenTelemetry__WithLogging__Exporters__Otlp__Endpoint=http://aspire.dashboard:18889
      - ApiBaseAddress=http://template.api:8080
    ports:
      - 9001:80
    depends_on:
      - aspire.dashboard

  gateway.api:
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_HTTP_PORTS=80
      - ASPNETCORE_HTTPS_PORTS=443
    ports:
      - 80:80
      - 443:443
    volumes:
      - ${APPDATA}/Microsoft/UserSecrets:/home/app/.microsoft/usersecrets:ro
      - ${APPDATA}/Microsoft/UserSecrets:/root/.microsoft/usersecrets:ro
      - ${APPDATA}/ASP.NET/Https:/home/app/.aspnet/https:ro
      - ${APPDATA}/ASP.NET/Https:/root/.aspnet/https:ro
